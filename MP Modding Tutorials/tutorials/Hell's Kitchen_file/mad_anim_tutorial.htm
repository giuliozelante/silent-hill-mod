<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0082)http://hellskitchen.paynereactor.com/Hell's%20Kitchen_files/mad_anim_tutorial.html -->
<HTML><HEAD><TITLE>Maddieman's Max Payne Animation Tutorial</TITLE>
<META content="text/html; charset=iso-8859-1" http-equiv=Content-Type>
<META content="MSHTML 5.00.2614.3500" name=GENERATOR></HEAD>
<BODY>
<H2>Maddieman's Tutorial on how to animate MP characters<BR></H2>
<P>The Example mod that goes with this tutorial is recommended you can download 
it <A 
href="http://hellskitchen.paynereactor.com/Hell's%20Kitchen_files/main_files/tutorial/anim_tutorial_example.zip?url=http://zer0mods.bwad.org.uk/old/anim_tutorial_example.zip">here</A></P>
<H4>-----------------------------------------------------------------------------<BR>Second 
Draft 17-9-2003<BR>Contact: <A 
href="http://hellskitchen.paynereactor.com/Hell's%20Kitchen_files/contact.htm" 
target=_self>Maddieman</A><BR>This document Copyright 2002-2003 Jonathan Hallier 
aka Maddieman<BR>Please do not alter or copy any part of this FAQ without my 
permission. <BR>Please contact me if you want to use this FAQ in another other 
places. 
<BR>-----------------------------------------------------------------------------</H4>
<H3>==VERSION HISTORY==</H3>
<P>25th July 2002 - Started Tutorial</P>
<P>27th July 2002 - Finished First Draft </P>
<P>27th July 2002 - Added example mod </P>
<P>17th September 2003 - Republished at Hell's Kitchen, cleaned up a bit, added 
a few 3ds max updates - but little detail.</P>
<P>---</P>
<P>Special thanks to Zer0 of <A href="http://zer0mods.bwad.org.uk/main.html" 
target=_blank>Zer0mods</A> for initial hosting of this tutorial.</P>
<P>----------------------------------------------------------------------------</P>
<H3>==Introduction==</H3>
<P>After many requests (well, one actually), I have decided to write a tutorial 
about creating custom<BR>character animations in Max Payne. It seems that only 
recently people have shown a sudden interest<BR>in animating Max Payne 
characters, and there appears to be only a few tutorials on the subject. <BR>The 
purpose of this tutorial is to inform those who are new to animating, what they 
will need,<BR>how to get started, and a few basic concepts and techniques. This 
tutorial is divided into 3 parts, <BR>the first deals with animating, the second 
deals with exporting animations into MP, and the final<BR>part contains the 
appendices. </P>
<P>I'll admit that in it's first stage, this tutorial is bit unfriendly looking, 
and assumes a fair amount<BR>of modding/programming knowledge - I'll be adding 
pictures later. To be honest, this isn't really a <BR>tutorial, as such. It 
covers the very basics, but really encourages you to try things out for 
yourself.<BR>A large section of the tutorial discusses the theory behind more 
advanced techniques (with examples), <BR>but will not provide a step by step 
guide. </P>
<P>In addition, this tutorial discusses common problems or issues that I have 
come across. If you encounter<BR>problems or solve issues that have not been 
addressed, then post them, or PM me, and I'll try to include <BR>them on the 
next release. </P>
<H2><BR>PART 1: Animating</H2>
<H3></H3>
<H3>==1. What you will need==</H3>
<P>i) A fully extracted data folder (preferably burnt to CD) - I've already 
written a tutorial detailing how to do this. Make sure you make a backup of the 
animations, default_skeleton.txt, Max_payne.txt, and the other text files 
contained in the skins directory.</P>
<P>ii) Compatible 3D animation package - For the purposes of this tutorial, I 
will be using Milkshape 3D. It's cheap, easy-ish to use, and compatible with 
most of the popular PC games, from 'Max Payne' to 'The Sims'. However, I would 
recommend 3D Studio Max, (since that's the program Remedy used to make MP) if 
you can afford it. Most of the points outlined in this tutorial will apply to 
both, though. IMPORTANT NOTE: Actor FX is NOT USED TO ANIMATE CHARACTERS - don't 
waste your time with it.</P>
<P>iii) A basic understanding of how MP works - i.e. you've have a bash at MaxEd 
and understand how FSM scripting works. If not, then I suggest you try that 
first.</P>
<H3>==2. Getting started==</H3>
<P>I will be brief on this, since there is already another tutorial that 
explains this in detail.</P>
<P>First go to the preferences and make sure the joint size is set to 0.025</P>
<P>There are 4 easy steps to setting up a Max Payne character for animation.</P>
<P>1. Import Mesh &amp; material data *.KFS<BR>- e.g. Max_Payne_l0.kfs</P>
<P>2. Import skeleton data *.SKD<BR>- e.g. Max_Payne_l0.skd</P>
<P>3. Import default skeleton/pose *.KF2<BR>- e.g. Widepose.k2f --note this is 
standard pose for all characters.</P>
<P>4. Create a default character *.ms3d<BR>- At this stage your character is 
ready to animate. To save time though, you may wish to save it (not export it) 
as a template character. You can then load this character, instead of having to 
import it with the above steps each time.</P>
<P>Like I said before, the other tutorial covers these stages in a bit more 
detail.</P>
<P>You now have a choice: Do you create an animation from scratch? Or do you 
edit an existing one?</P>
<P>For beginners, the best (visual) results will be produced from editing 
existing ones. However, this tutorial will not make any specific reference to 
particular animations.</P>
<H3>==3. The Basics==</H3>
<P>Animation is produced by rapidly displaying still images or frames, at a 
speed quicker than the eye's perception. Animation in video games is no 
exception. Characters in MP are animated by positioning multiple 'joints' 
(limbs, members, etc.) into specific poses (frames). These poses are called the 
'Key Frames', and by creating multiple 'Key Frames' animation is produced. The 
computer will automatically calculate the in-between frames; i.e. the frames 
required to move the character from 'pose 1' to 'pose 2'. The main benefit of 
this is that if you have a long animation (100+ frames) you only need to animate 
about 10 frames, the computer will do the rest for you. Keyframe animation is a 
fundamental concept in computer animation, and, er, I don't think I explained it 
very well. Take this example, for instance: Imagine you wanted to animate a 
character getting up from a chair. There are two major poses that spring to 
mind, 1: the character sitting down; and 2: the character standing upright. All 
that you would need to animate is these two frames - the program then calculates 
the movements or frames needed to move the character from the first position to 
the second. If you're still in any doubt about it, there are plenty tutorials 
and articles that will explain frames and keyframes in more detail (Curious Labs 
poser tutorials are particularly good).</P>
<H4>=Animation Mode in Milkshape=</H4>
<P>There are two main modes in Milkshape, modelling and animating. Modelling is 
the default and allows you to change the character mesh and tweak the mapping of 
textures. Animation mode is, of course, where you create animations for your 
characters. You can activate animation mode by clicking on the animation button 
in the bottom right hand corner (provided you have enabled the animation 
toolbar). Milkshape contains all of the standard animation features that you 
would expect from a 3D animating package; including play, rewind, move 
forward/backward 1 frame, jump to next/previous keyframe, etc. </P>
<H4><BR>=How Many Frames?=</H4>
<P>If you're starting from scratch, the first thing that you need to decide is 
how many frames your animation will last. Milkshape displays it's animations at 
24 frames per second; this can be changed, but I don't recommend it. The average 
length of animations in MP is about 30 to 50. I don't think there is a limit, 
but the longest animation I've made lasted 200 frames. Understand that the more 
frames you have, the smoother the animation will be, at the cost of speed and 
memory. </P>
<H4>=Skeletons and Joint Hierarchy=</H4>
<P>Like us, characters in MP have skeletons. Each skeleton is separated into 
joints which define key areas of the body, such as arms, legs, head, etc. NOTE: 
Milkshape et al, call these components JOINTS, MP however, refers to them as 
BONES - Same difference really. </P>
<P>In addition to this, the joints are organised into a hierarchy list. This 
means that joints lower down on the hierarchy list are affected by joints above 
them. For example, if you move the upper arm of a character, the lower arm, 
hand, and gun joints will also move with it. If you move the lower arm, the 
hand, and gun joints will move, but the upper arm will remain in place. And so 
on...</P>
<P><BR>There are a few key joints that you will be constantly animating:</P>
<P><BR>Pelvis: This is the central, or spine joint, of the skeleton. It is 
highest on the hierarchy list and thus, moving it will move every single joint 
in the skeleton. - Useful for jumping, falling, spinning, etc.</P>
<P>Torso: This affects the upper body of the skeleton - including head, 
chest/abdomen, and arms.</P>
<P>Upper legs l/r: Controls movement of the thigh - which affects the lower leg, 
foot, and toe joints, as well.</P>
<P>Lower Legs l/r: Moves all of the joints below the knee - i.e. lower leg, 
foot, and toe</P>
<P>Upper arm l/r: Ditto, but worth noting that the gun joint is locate on the 
RIGHT HAND.</P>
<P>Lower arms l/r: Moves all of the joints below the elbow - i.e. forearm, hand, 
and gun</P>
<P><BR>Head: Essential for giving personality to your animation. <BR></P>
<P>There are a few other joints that are used to make up the Max Payne skeleton, 
including bones that control the movement of the upper and lower segments of 
Max's jacket. Most of the time, you wont need to move these unless you're 
attempting something fancy.</P>
<H4><BR>=Setting and Removing Keyframes=</H4>
<P>As stated before, animation in MP is made by creating keyframes: specific 
poses which define the major movements of animation. If you followed the above 
steps correctly, you should have a 3d model of Max Payne, complete with a stupid 
grin on his face. Before you do anything, go to the animation menu and disable 
'operate on select joint only'. It's worth making the first keyframe the default 
pose, so click on the drop down menu called 'Animation' and choose: 'set 
keyframe'. IMPORTANT: If you make any changes to the position of the joints, 
DON'T FORGET TO SET THE FRAME AS A KEYFRAME!!! If you don't, then you will lose 
the position data as soon as you move to the next frame. I'm always forgetting 
this, so you'll thank me later. </P>
<P>The shortcut key for setting keyframes is: &lt;CTRL&gt; + K. This will come 
in handy later, once your animation is complete. In the troubleshooting section, 
I will explain why, but for now all you need to know is that it's more 
convenient. You can also remove a keyframe with &lt;CTRL&gt; + &lt;SHIFT&gt; + 
K; it's more awkward, but can also be selected from the drop-down menu.</P>
<H4><BR>=Positioning Joints=</H4>
<P>Ok, this is what it's all about, moving joints to create poses -- a technique 
referred to as <STRONG>Forward Kinematics</STRONG>. First of all, another 
important note: For reasons which I can't explain, Milkshape displays a mirror 
image of what the animation is supposed to look like; i.e. the arms and legs are 
on the wrong side. Unfortunately, I was completely unaware of this fact until it 
was too late. There is a feature which is supposed to reverse all of the joint 
data in Milkshape, however it does not work very well. Just remember that when 
you export the animation into Max Payne, everything will be reversed back to 
normal.</P>
<P>In Milkshape, choose the joints tab and select a joint (for the sake of 
example, choose an upper arm). Now go to the tools tab and select ROTATE. You 
will now see three boxes, labelled X, Y, and Z. These let you rotate the joint 
in the said dimension, by x amount of degrees. I normally use a value of 10 
degrees, or 5 for fine tuning. If you make a mistake you can use &lt;CTRL&gt;+Z 
to undo, or use a negative value (-10), to rotate the joint in the opposite 
direction.</P>
<P>You will have to work out how the joints move on your own, I sometimes feel 
they move randomly. It's a case of trial and error, but with a bit of patience, 
you should be able to get them into the desired position.</P>
<P>Once you have your joint in position, set the frame as a keyframe; then 
select a new joint. Repeat.</P>
<P>When you are happy with your pose, set it as a keyframe, and then save the 
file. I recommend creating several backups, at regular intervals, in case you 
seriously mess it up. </P>
<P>Depending on the speed of your animation, you should advance the frames 
slider by about 3 to 5 frames (10 if you're feeling lucky). Notice that the pose 
remains intact, meaning you only have to move a few joints. Keep doing this 
until you're happy with your 'animation'. Don't worry if you have miss-judged 
how many frames your animation requires: - you can add or delete frames at any 
point by clicking on the 'frame x of y frames' box.</P>
<H3><BR>==4. Advanced Techniques==</H3>
<H4><BR>=Cut, Copy, Paste, &amp; Deleting keyframes</H4>
<P>Not exactly and advanced technique, but if you think the timing is wrong, 
then you can use these standard tools to move key frames about. Unfortunately, 
I've yet to discover a way to copy multiple keyframes; right now you'll have to 
adjust things one frame at a time. </P>
<H4><BR>=Squished Limbs Syndrome=</H4>
<P>Once you've finished your animation, you may have already tried exporting it 
into the game. If you exported it correctly, you may notice that the character's 
joints sometimes squash and stretch out of proportion (sometimes going 2D) in 
between keyframes. The only logical reason I have that explains this, is that 
Milkshape and Max Payne calculate the in between frames differently. I guess 
this is where you're supposed to bring in Actor FX to test the weighting of the 
character, but never mind about that. The best workaround, is to make each frame 
a keyframe (remember the note about ctrl-k?); thus Max Payne does not have the 
opportunity to calculate the in between frames, reducing the margin of 
error.</P>
<BLOCKQUOTE>
  <P><STRONG>UPDATE:</STRONG></P>
  <P><STRONG>This has nothing to do with Actor FX - it is simply a quirk of 
  exporting animations from Milkshape 3d. The bug will not occur if you export 
  from 3DS Max.</STRONG></P></BLOCKQUOTE>
<H4><BR>=Move tool and the pelvis joint=</H4>
<P>In some instances, it may be necessary to move the entire skeleton. Normally, 
using the move tool with a joint causes horrific (yet amusing) results. However, 
if you understand the hierarchy you will be aware that the PELVIS joint moves 
everything. This allows you to move or rotate the whole figure, which is useful 
for jumping or falling. I do not recommend using the move tool for walking 
animations, etc. As a general rule, your animations should remain on the spot, 
and should not be moved in the x or z direction. If you've downloaded the 'Dodge 
This' dev kit, you will be undoubtedly aware of how cool the long jump was, yet 
it didn't work very well. Why? Well, the Morpheus character was moved along the 
Z axis during the animation, instead of animating him on the spot. Basically the 
game co-ordinates thought he was in one position, but the animation depicted him 
in another. This caused numerous collision-detection, camera, and control 
problems which could have been avoided (not to dis the Dodge this team, what 
they had finished was awesome). </P>
<BLOCKQUOTE>
  <P><STRONG>UPDATE:</STRONG></P>
  <P><STRONG>As a general rule of thumb, rarely ever should you move the pelvis' 
  postion, except for when a character ducks or falls over. If you want them to 
  jump, use the C_jump() message.</STRONG></P></BLOCKQUOTE>
<H4><BR>=Camerapaths=</H4>
<P>...can't be done in Milkshape (believe me, I've tried!) so forget it.</P>
<BLOCKQUOTE>
  <P><STRONG>UPDATE:</STRONG></P>
  <P><STRONG>See: <A 
  href="http://forums.3drealms.com/ubbthreads/showflat.php?Cat=&amp;Board=UBB18&amp;Number=341408&amp;Forum=,f18,&amp;Words=camerapaths&amp;Searchpage=0&amp;Limit=25&amp;Main=341407&amp;Search=true&amp;where=bodysub&amp;Name=&amp;daterange=0&amp;newerval=&amp;newertype=&amp;olderval=&amp;oldertype=#Post341408&amp;bodyprev=" 
  target=_blank>Camerapaths</A></STRONG></P></BLOCKQUOTE>
<H4><BR>=Shoot Dodges, Aiming, and other Blending animations=</H4>
<P>These are special types of animations where one animation blends seamlessly 
into another. Think of the shootdodge move, and how you can twist Max's torso to 
aim in different directions. There are in fact 8 shootdodge animations, one for 
each direction, plus another 8 for two handed weapons, such as rifles and 
shotguns. </P>
<P>One of the most common errors people get is when they try to edit the 
shooting animation, and get the error:</P>
<H4>ERROR: animation x does not have the same amount of frames as animation 
y</H4>
<P>The reason for this, is that the player is supposed to be able to aim in 360 
degrees. Therefore, three animations were used: aim up, aim down, aim straight 
ahead. The Max Payne engine then calculates the positions in between, producing 
a 360 degree aiming arc. The above error is caused when you edit one of the 
shooting animations (e.g. shootberetta.kf2) and forget to adjust the others 
accordingly (shootberetta_up.kf2 and shootberetta_down.kf2).</P>
<H4><BR>=Running animations=</H4>
<P>I've had numerous problems with editing this animation. I was trying to 
change it, so that the character sprinted, instead of the sort jog thing that 
Max does. After the first loop the character stops dead. I think this has to do 
with number of frames contained in the animation (the default was 40 - my one 
was reduced to 18). Although the game doesn't crash out with an error, the 
blending rules may still apply. I'll update this once I find out the 
solution.</P>
<BLOCKQUOTE>
  <P><STRONG>UPDATE:</STRONG></P>
  <P><STRONG>Looping animations, such as run or walk cycles, can only be 
  exported properly with 3ds Max. In the export box, check "looping". You can 
  also define which frame to loop back to, if you don't want the animation to 
  loop to the very start.</STRONG></P></BLOCKQUOTE>
<H4><BR>=Inverse Kinematics=</H4>
<P>Inverse kinematics is a feature in some 3d animation packages (3ds max) that 
helps automate the animating process. It works by animating from the bottom of a 
bone hierarchy, rather than the root, as in <STRONG>FK</STRONG>. This means that 
if, for example, you lift the character's foot up, their thigh and lower leg 
will bend in a realistic way. By far the most useful aspect of this is that you 
can move the pelvis without the enitire figure moving out of position (i.e. the 
feet say rooted to the ground). Sadly though, Milkshape does not have this 
feature at the moment. </P>
<BLOCKQUOTE>
  <P><STRONG>UPDATE:</STRONG></P>
  <P><STRONG>3ds Max offers several variations of IK. While I don't have time to 
  go into the details of explaining how to set up IK solvers, if you want a 
  quick IK fix, try using "Interactive IK" under the IK section of the hierarchy 
  tab. Since you're not using a proper IK solver, limbs might move into 
  unnatuaral postions, so make sure you correct these errors as they 
  occur.</STRONG></P></BLOCKQUOTE>
<H4><BR>=Motion Capture=</H4>
<P>Most of the animations in Max Payne 2 were recorded using motion capture, 
rather than hand animation. Unfortunately, this facility won't be available to 
the average maddieman.</P>
<P><BR><STRONG>=3DS MAX= (added 2003)</STRONG></P>
<P>I'm not going to spend to much time on this, since incredibly in-depth help 
and tutorial articles come packaged with it. Also, Endo and LJ did a pretty good 
tutorial over at their site, with pictures and stuff. So instead, I'll keep this 
short and relevant to Max Payne.</P>
<P><STRONG>Setting up</STRONG></P>
<P>You might find that the basic Max Payne skeleton that Remedy provided is a 
little tricky to work with. Not only is the animation set to loop, there's a 
grid that must be deleted, he won't render, and a bit of experimentation might 
produce erratic results (think spinning heads and twisting limbs). Then when you 
export.... :)</P>
<P>Ok, first off, you might want to consider deleting the grid now, rather than 
later. You don't have to, but bear in mind that it causes your animations to 
crash in Max Payne, and can interfere with the IK. You can add another grid 
later if you want, in fact any object will work just as well.</P>
<P><STRONG>Viewport Layout</STRONG></P>
<P>This is more of a personal preference than anything, but I tend to find the 
following viewport layout the most useful for animating:</P>
<P><IMG height=412 src="mad_anim_tutorial_file/viewport.jpg" width=506></P>
<P>It gives quick access to all of the key angles, as well as the all important 
Perspective viewpoint.</P>
<P><STRONG>The Dork</STRONG></P>
<P>Now we're going to set up the character as template for future animating. 
First off, double click on his pelvis and delete all the key frames for the 
entire model. Now, click on each bone in turn, and go to motion tab. Under 
<STRONG>assign controller</STRONG>, you'll see a hierarchy window/box with 
<STRONG>postion, rotation, and scale </STRONG>listed. Click on <STRONG>Rotation: 
TCB Rotation, </STRONG>then click on the green arrow button, just above the box. 
You'll be presented with a list; choose Linear Rotation for now. Do this for all 
of the bones, except for the jacket ones.</P>
<P><IMG height=383 src="mad_anim_tutorial_file/controller.jpg" width=481></P>
<P><STRONG>Linear vs TCB</STRONG></P>
<P>Don't get me wrong here, the TCB controller is better for smooth character 
animation, but is a lot harder to use. If you've tried animating with it, the 
chances are that you've already experienced situations where limbs spin or twist 
360 degrees in between frames. Using the linear controller is a lot like 
animating in Milkshape -- it's very rigid, but gets the job done nice and 
simply. <EM>Then </EM>you change everything back to TCB to smoothen out the 
animation.</P>
<BLOCKQUOTE>
  <P><STRONG>NB: If you happen to be working with TCB and joints start to twist 
  (indicated by red circular movement paths in the viewpoint), a simple and 
  effective fix is to just click on the offending joint, then switch it to 
  linear, then back to tcb -- problem solved. :)</STRONG></P></BLOCKQUOTE>
<P><STRONG>Exporting</STRONG></P>
<P>A lot of people have asked me about this, so for simplicity, I decided just 
to take a snapshot of working export options.</P>
<P><IMG height=416 src="mad_anim_tutorial_file/export.jpg" width=510></P>
<P>Use this dialogue for exporting animations, models, weapons, and projectiles. 
For animations though, simply use the above settings. If you're making a 
<STRONG>looping</STRONG> animation, like a walk, or run cycle - or even a 
standing animation; then make sure to tick "<STRONG>Loop when 
finished</STRONG>". <EM>Loop interpolation</EM> will interpolate (i.e. calculate 
the in-betweens) the first and last frames of your animation automatically, and 
Dec. end frame by one removes the last frame. At the top, <STRONG>Loop to frame 
</STRONG>make the animation return to a specific frame instead of looping to the 
very start of the animation. </P>
<P>Alright that's 3ds max covered for the time being. For a more extensive 
coverage of the basics, check out <A href="http://ghettogunz.tk/" 
target=_blank>Ghetto Gunz</A>.</P>
<P>***</P>
<P>Well, that's pretty much it for the animation side things. If you're still 
stuck, feel free to post your questions. If you're trying to make your 
animations more lifelike, then I suggest you read some of the tutorials for 
Poser or 3DS Max. While they're a more advanced animation package, the basic 
concepts still apply.</P>
<H2><STRONG>PART 2: Using Your Animation in Max Payne</STRONG></H2>
<P><BR>A lot of people find this part quite daunting, so I suggest you 
familiarise yourself with MaxEd and FSM scripting first.</P>
<H3></H3>
<H3>==1. Exporting to *.Kf2 format==</H3>
<P><BR>Still here? OK, when you have a finished animation, click file/export/MP 
models, animations, etc. <BR>Name your file, and don't forget to add the 
extension .kf2<BR>Choose 'export animation' and hit OK.<BR>This should create 
your animation.kf2 file which you can use in Max Payne.</P>
<H3><BR>==2. Using your animation in Max Payne==</H3>
<H4>=First timer=</H4>
<P>Place your animation in the ..\data\database\skeletons\default_skeleton\anim 
directory</P>
<P>If you're just starting out, I suggest you try to replace an existing 
animation (e.g. A death animation, such as death_shotgun_b.kf2). Be sure to make 
a backup of the original first, though. For compatibility, keep the length of 
frames identical (otherwise you will get errors).</P>
<P>If you do get errors relating to the amount of frames, and you're not afraid 
of code, then try the following procedure:</P>
<P>First open the 'default_skeleton.txt' and do a search for the filename of the 
animation that you replaced.<BR>There are lines of code that begin: "[Message] 
Frame = x " the number (x) refers to a specific frame in your animation. If the 
frame does not exist, then you have a choice: either lengthen the animation, or 
edit the text so that x falls within the number of frames in your animation.</P>
<P>If this still does not work, then leave it for now, it probably employs 
blending.</P>
<P><BR>Hopefully, that will get you started, and you should be able to 
experiment a bit, finding out what you can and can't change.</P>
<H3><BR>==3. Advanced Techniques==</H3>
<P>If you know how to use the *.txt files, then you're better off giving your 
animation a unique name. This reduces the chances of overwriting something 
important. Open the text files (usually default_skelelton.txt) and find the 
animation you want to replace. Rename it, and make sure that any FSM messages 
which refer to frames are correct.</P>
<H4><BR>=Custom Animations=</H4>
<P>This has been stressed time and time again, but what the hell: Max Payne 
offers very little opportunities to add totally new things. Since you don't have 
access to the source code, you can't implement new features. You can, however, 
replace what already exists. This is the basic concept of modding, be it 
textures, skins, levels, weapons, or animations. There are ways around these 
problems though, as this next example illustrates.</P>
<H4>=EXAMPLE=</H4>
<P>So, you want to add a new death animation? Fair enough, but after scanning 
the default_skeleton.txt you've realised that there are only four random death 
animations, plus about six more specific ones (shotgun deaths, etc.). This is 
one hell of a restriction, so how do you get around it? Well, each character in 
Max Payne (including Max) refer to the default_skeleton.txt file to get their 
default parameters, skeletons, and animation sets. This saves the programmers 
time, because they do not have to write the code, for loading generic animations 
(e.g. walking) for each character. However, if you look in the skins folder, you 
will find a text file for each character. These contain modifiers, which adjust 
the values set down by the default_skeleton.txt to make the character more 
unique. These might include how many hitpoints the character has, or how 
accurate they are; but more importantly, it contains specific animation sets. 
For example, some of the characters have special 'idle' animations where they 
use a mobile phone or something. As well as specific animations, you can modify 
any of the animations originally set down in the default_skeleton.txt. Sticking 
with our death animation example, this means that one character can have four 
completely different death animations from another. There are about 45 different 
characters (excluding redundant ones like the baby, or the invisible one) which 
means (in theory) you can include...180 different death animations, and that's 
not even including the shotgun or grenade ones! </P>
<P>Disk space is not an issue either, because the total size of all of the 
animations comes to around 11MB. Of course, neither Remedy, nor myself, could be 
bothered to create that many death animations. It also stands, that only around 
ten of the characters are actually used as enemies in the main game, but the 
theory is still sound. In fact, it also applies to every type of animation, 
meaning that characters could have their own style of walking, or shootdodging, 
etc.</P>
<H4></H4>
<H4>=FSM Scripting=</H4>
<P><BR>In the text files, all animations conform to the following syntax:</P>
<P><BR>[Animation] Index = CHARANIM_x; Filename = 
anim\x.kf2;<BR>[Properties]<BR>{<BR>[Movement] EndPosition = ( 0, 0, 0 ); 
Rotation = (0,0,0);Middleposition1 = (0,0,0); Middleposition2=(0,0,0);</P>
<P>[Message] Frame = 0; String = "Receiver-&gt;Message;";</P>
<P>}<BR></P>
<P>CHARANIM_x </P>
<P>- refers to a specific animation ID (e.g. CHARANIM_WALK) - I don't think 
these can be changed, since they refer to the source code and how the game 
plays. For the same reason, I don't think you can make custom ones either.</P>
<P></P>
<P>anim\x.kf2 </P>
<P>- where x is the filename. This is the filename which you can change to 
import your custom animations.</P>
<P></P>
<P>[Movement] EndPosition = ( 0, 0, 0 ); Rotation = (0,0,0); Middleposition1 = ( 
0, 0, 0); Middleposition2 = ( 0, 0, 0 );</P>
<P>- Remember the note about the Dodge this long jump? This is the line you need 
to change to move the character during the animation. (x,y,z) refers to the 
position where the character will end up, the distance is in meters. Obviously, 
a value of 0 will not move the character; both negative and positive floating 
point numbers are accepted. Rotation, will rotate the character. This is not 
really needed, since you can rotate the character in the animation. 
Middlepositions are used to tell MP where the character should be at certain 
points during the animation.</P>
<P></P>
<P><BR>[Message] Frame = 0; String = "Receiver-&gt;Message;"; </P>
<P><BR>- These are the important lines, they are optional, and you can have as 
many or as few as you want. If you are not familiar with FSM scripting in MaxEd, 
then I suggest you do so first. You can send any FSM message, just like in 
MaxEd. The key difference is that you are editing code for the entire game - not 
just a specific level. This means that you cannot refer to level objects such as 
::startroom::e1, etc. The most common receiver you will use is 'THIS', the 
character who is being animated. Frame refers to a specific frame in the 
animation. If the frame does not exist, then MP will take the huff. In addition, 
I've also found that messages sent on the very last frame also cause errors. As 
general rule of thumb, don't send any messages on the last frame; finish 
everything off on the second-to-last one.</P>
<P>Notice that the message is in a text string, enclosed with " " and the line 
is completed with a semi-colon (;). One of the most common errors you get is 
'File.txt does not end!'. The most likely cause of this error, is that you 
forgot to add the "; at the end of the line. Remember that you are sending a 
command within a command, which means that not only does the FSM string have to 
have a semi-colon, but also the 'String =' line as well. </P>
<P><BR><STRONG>EXAMPLE 1) Flying backwards</STRONG></P>
<P>Imagine that I have made a new shotgun death animation. I want the enemy to 
fly back and splat against a wall (think of the Pit fatality in MKII). </P>
<P>Here is the original code:</P>
<P></P>
<P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Animation] Index = 
CHARANIM_SHOTGUNDEATH; Filename = 
anim\death_shotgun_a.kf2;<BR>[Properties]<BR>{</STRONG></FONT></P>
<BLOCKQUOTE>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Movement] 
  EndPosition = ( 0, 0, -3.63855 ); Rotation = (0,0,0); Middleposition1 = ( 0, 
  0, -2.57104); Middleposition2 = ( 0, 0, -3.28023 );<BR>[Message] Frame = 0; 
  String = "this-&gt;C_AnimateTexture( " FACETEXTURE_ID "," FACETEXTURE_DEATH_ID 
  "," 0 ");";<BR>[Message] Frame = 0; String = "this-&gt;A_Play3DSound ( enemy, 
  mobster_death, head );";<BR>[Message] Frame = 0; String = 
  "this-&gt;c_jump(5);";<BR>[Message] Frame = 0; String = 
  "LeftHandWeapon-&gt;WS_Animate(" WEAPONANIM_DROPONDEATH ");";<BR>[Message] 
  Frame = 1; String = "RightHandWeapon-&gt;WS_Animate(" WEAPONANIM_DROPONDEATH 
  ");";<BR>[Message] Frame = 22; String = "this-&gt;A_Play3DSound ( characters, 
  death_medium, pelvis );";<BR>[Message] Frame = 24; String = 
  "this-&gt;P_CreateprojectileToBone( dummy_character_land, 1, torso 
  );";<BR>[Message] Frame = 36; String = "this-&gt;P_CreateprojectileToBone( 
  dummy_character_land, 1, torso );";<BR>[Message] Frame = 36; String = 
  "this-&gt;A_Play3DSound ( characters, death_medium, pelvis );";<BR>[Message] 
  Frame = 38; String = "this-&gt;P_CreateProjectileToBone( blood_dummy, 2, torso 
  );";</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face="Courier New, Courier, mono" size=2><STRONG>}</STRONG></FONT></P>
<P><BR>The movement line explains that the character is going to move -3.63855 
meters along the z axis, during the animation. In other words, he is going to 
fall backwards.</P>
<P>Frame 0: Change the facial expression of the character. <BR>Play death cry, 
emitted from head<BR>Launch the character vertically, at a speed of 
5m/ps<BR>Drop any weapons that might be held in the left hand</P>
<P>Frame 1: The character drops the weapon in his right hand.</P>
<P>Frame 22: Hmm, not sure about this one. A sort of generic death sound</P>
<P>Frame 24/36: Creates a projectile that will cause damage to others or make a 
mark on the walls/floor</P>
<P>Frame 36: Play a 'thud' sound when the character lands</P>
<P>Frame 38: Spawn blood from the body.</P>
<P></P>
<P><BR>Here is the code for my new animation:</P>
<P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Animation] Index = 
CHARANIM_SHOTGUNDEATH; Filename = 
anim\Splat_death.kf2;<BR>[Properties]<BR>{</STRONG></FONT></P>
<BLOCKQUOTE>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG><BR>[Movement] 
  EndPosition = ( 0, 0, -50); Rotation = (0,0,0); <BR>[Message] Frame = 0; 
  String = "this-&gt;C_AnimateTexture( " FACETEXTURE_ID "," FACETEXTURE_DEATH_ID 
  "," 0 ");";<BR>[Message] Frame = 0; String = "this-&gt;A_Play3DSound ( enemy, 
  splatter, head );";<BR>[Message] Frame = 0; String = 
  "this-&gt;c_jump(5);";<BR>[Message] Frame = 0; String = 
  "LeftHandWeapon-&gt;WS_Animate(" WEAPONANIM_DROPONDEATH 
  ");";</STRONG></FONT></P>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Message] Frame = 1; 
  String = "RightHandWeapon-&gt;WS_Animate(" WEAPONANIM_DROPONDEATH 
  ");";<BR>[Message] Frame = 1; String = "this-&gt;A_Play3DSound ( camera, 
  swoosh_01, torso );";</STRONG></FONT></P>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Message] Frame = 
  15; String = "this-&gt;A_Play3DSound ( enemy, generic_fire_death, head 
  );";</STRONG></FONT></P>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Message] Frame = 
  22; String = "this-&gt;A_Play3DSound ( characters, death_medium, pelvis 
  );";<BR>[Message] Frame = 24; String = "this-&gt;P_CreateprojectileToBone( 
  dummy_character_land, 1, torso );";<BR>[Message] Frame = 36; String = 
  "this-&gt;P_CreateprojectileToBone( dummy_character_land, 1, torso 
  );";</STRONG></FONT></P>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Message] Frame = 
  38; String = "this-&gt;P_CreateProjectileToBone( blood_dummy, 2, torso 
  );";</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face="Courier New, Courier, mono" size=2><STRONG>}</STRONG></FONT></P>
<P><BR>I've change it so that the character flies back 50 meters, guarantying 
that they will hit a wall (despite what you might think - it worked really 
well).</P>
<P>Frame 0: Change facial expression</P>
<P>Frame 0: Play 'splat' noise on contact</P>
<P>Frame 0: Again, launch the goon into the air</P>
<P>Frame 0: Drop any weapons that might be held in the left hand</P>
<P>Frame 1: The character drops the weapon in his right hand.</P>
<P>Frame 1: Play a swoosh noise, as the character flies backwards</P>
<P>Frame 15: Character hits the wall, arms &amp; legs spread out wide, he 
screams like a maniac</P>
<P>Frame 22: Again this generic death sound, which I haven't really bothered to 
investigate</P>
<P>Frame 24/36: Creates a projectile that will cause damage to others or make a 
mark on the walls/floor</P>
<P>Frame 38: Spawn blood from the body.</P>
<P><BR>The final result is quite, amusing.</P>
<P><BR><STRONG>EXAMPLE 2) Uncontrolled shooting</STRONG></P>
<P>I want the character to shoot uncontrollably as he dies.</P>
<P>By now, you should have a fair idea how this FSM stuff works. The following 
code completely replaces the original.</P>
<P></P>
<P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Animation] Index = 
CHARANIM_RANDOMDEATH1; Filename = 
anim\Death_Fallback_ShootUpwards.kf2;<BR>[Properties]<BR>{</STRONG></FONT></P>
<BLOCKQUOTE>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Movement] 
  EndPosition = (0,0,-2); Rotation = (0,0,0);<BR>[Message] Frame = 0; String = 
  "this-&gt;C_AnimateTexture( " FACETEXTURE_ID "," FACETEXTURE_DEATH_ID "," 0 
  ");";<BR>[Message] Frame = 0; String = "this-&gt;A_Play3DSound ( enemy, 
  mobster_death, head );";<BR>[Message] Frame = 0; String = 
  "this-&gt;P_CreateProjectileToBone( blood_dummy, 2, torso 
  );";</STRONG></FONT></P>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Message] Frame = 1; 
  String = "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 2; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 3; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 4; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 6; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 8; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 10; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 13; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 16; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 19; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 22; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";<BR>[Message] Frame = 25; String = 
  "RightHandWeapon-&gt;WS_AnimateShooting(" WEAPONANIM_SHOOT "," 
  WEAPONANIM_SHOOTEMPTY ");";</STRONG></FONT></P>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG><BR>[Message] Frame 
  = 40; String = "this-&gt;A_Play3DSound ( characters, death_medium, pelvis 
  );";<BR>[Message] Frame = 46; String = "this-&gt;P_CreateprojectileToBone( 
  dummy_character_land, 1, torso );";</STRONG></FONT></P>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Message] Frame = 
  45; String ="this-&gt;PS_StartEffect ( item_drop, torso );"; 
  </STRONG></FONT></P>
  <P><FONT face="Courier New, Courier, mono" size=2><STRONG>[Message] Frame = 
  45; String = "LeftHandWeapon-&gt;WS_Animate(" WEAPONANIM_DROPONDEATH 
  ");";<BR>[Message] Frame = 46; String = "RightHandWeapon-&gt;WS_Animate(" 
  WEAPONANIM_DROPONDEATH ");";</STRONG></FONT></P></BLOCKQUOTE>
<P><FONT face="Courier New, Courier, mono" size=2><STRONG>}</STRONG></FONT></P>
<P><BR><BR>The first few frames do the usual stuff, change facial expression, 
make the character scream, etc.</P>
<P>The important frames are 1 to 25. The command is used to fire the weapon in 
his right hand 12 times. It looks stupid with a shotgun, but fun anyway.</P>
<P>Also notice that the weapon(s) are dropped on frames 45 and 46, not 0. </P>
<P>You may be thinking, that a character who shoots after they've been killed is 
a little unfair. I have never been hit yet (it's still possible though), this is 
more for show.</P>
<P>I have included an example mod to go with this tutorial. Feel free to extract 
it too find out how it works.</P>
<HR>

<P>Well, that's it for now, I guess. I'm not quite sure how easy it was to 
follow, but congratulations if you got this far.</P>
<P>Looking forward to seeing your work</P>
<H3>-Maddieman</H3>
<P>&nbsp;</P>
<P><STRONG>==FURTHER READING==</STRONG></P>
<P>Milkshape 3D - <A 
href="http://www.swissquake.ch/chumbalum-soft/index.html">http://www.swissquake.ch/chumbalum-soft/index.html</A><BR>Importing 
MP characters into Milkshape - <A 
href="http://www.swissquake.ch/chumbalum-soft/ms3d/tutorials/mp/" 
target=_blank>http://www.swissquake.ch/chumbalum-soft/ms3d/tutorials/mp/</A><BR>PolyGods 
(some good Milkshape tutorials) - <A 
href="http://hellskitchen.paynereactor.com/Hell's%20Kitchen_files/www.PolyGods.com">http://hellskitchen.paynereactor.com/Hell's%20Kitchen_files/www.PolyGods.com</A></P>
<P><A href="http://aavenr.8m.com/" target=_blank>Aavenr's animation tutoria</A>l 
-- Primarily targeted for MaxEd users, covers the basics quite well.</P>
<P><A href="http://ghettogunz.tk/" target=_blank>Ghetto Gunz</A> -- Covers the 
basics of Max Payne animation with 3ds Max. Lots of pictures, which is nice.</P>
<P><STRONG>3d Realms Forums:</STRONG></P>
<BLOCKQUOTE>
  <P><A 
  href="http://forums.3drealms.com/ubbthreads/showflat.php?Cat=&amp;Board=UBB18&amp;Number=340945&amp;Forum=,f18,&amp;Words=%221000%20fps%20animations%22&amp;Searchpage=0&amp;Limit=25&amp;Main=340945&amp;Search=true&amp;where=bodysub&amp;Name=&amp;daterange=0&amp;newerval=&amp;newertype=&amp;olderval=&amp;oldertype=#Post340945&amp;bodyprev=" 
  target=_blank>1000 fps animations</A></P>
  <P><A 
  href="http://forums.3drealms.com/ubbthreads/showflat.php?Cat=&amp;Board=UBB18&amp;Number=341408&amp;Forum=,f18,&amp;Words=camerapaths&amp;Searchpage=0&amp;Limit=25&amp;Main=341407&amp;Search=true&amp;where=bodysub&amp;Name=&amp;daterange=0&amp;newerval=&amp;newertype=&amp;olderval=&amp;oldertype=#Post341408&amp;bodyprev=" 
  target=_blank>Camerapaths</A></P>
  <P><A 
  href="http://forums.3drealms.com/ubbthreads/showflat.php?Cat=&amp;Board=UBB18&amp;Number=342693&amp;Forum=,f18,&amp;Words=interaction&amp;Searchpage=0&amp;Limit=25&amp;Main=342691&amp;Search=true&amp;where=bodysub&amp;Name=&amp;daterange=0&amp;newerval=&amp;newertype=&amp;olderval=&amp;oldertype=#Post342693&amp;bodyprev=" 
  target=_blank>Enemy Interaction</A></P>
  <P><A 
  href="http://forums.3drealms.com/ubbthreads/showflat.php?Cat=&amp;Board=UBB18&amp;Number=340548&amp;Forum=,f18,&amp;Words=%22projectile%20death%22&amp;Searchpage=0&amp;Limit=25&amp;Main=340542&amp;Search=true&amp;where=bodysub&amp;Name=&amp;daterange=0&amp;newerval=&amp;newertype=&amp;olderval=&amp;oldertype=#Post340548&amp;bodyprev=" 
  target=_blank>Adding Projectile Death Animations</A></P></BLOCKQUOTE>
<P>&nbsp;</P>
<P><STRONG>FIN</STRONG></P>
<P>&nbsp;</P>
<P align=center><A href="http://hellskitchen.paynereactor.com/" 
target=_parent><FONT 
face="Verdana, Arial, Helvetica, sans-serif">Home</FONT></A></P></BODY></HTML>
